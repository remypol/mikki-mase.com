---
import BaseLayout from '../../layouts/BaseLayout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import Breadcrumbs from '../../components/Breadcrumbs.astro';

const toolSchema = {
  "@type": "WebApplication",
  "name": "Baccarat Bankroll Calculator",
  "applicationCategory": "FinanceApplication",
  "operatingSystem": "Web Browser",
  "description": "Professional bankroll management calculator with real-time visualization. Calculate session bankroll, stop-loss limits, and win goals.",
  "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
  "author": { "@id": "https://mikki-mase.com/#person" }
};
---

<BaseLayout
  title="Baccarat Bankroll Calculator | Mikki Mase"
  description="Calculate your optimal baccarat session bankroll with real-time visualization. Professional tool based on Mikki Mase's bankroll management."
  schema={toolSchema}
>
  <Header />

  <div class="bg-black border-b border-gray-800">
    <Breadcrumbs items={[
      { label: "Home", href: "/" },
      { label: "Tools", href: "/tools" },
      { label: "Bankroll Calculator" }
    ]} />
  </div>

  <main class="min-h-screen bg-gradient-to-b from-black via-gray-900 to-black py-12 md:py-20">
    <div class="container mx-auto px-6 max-w-7xl">

      <!-- Header -->
      <div class="text-center mb-12">
        <h1 class="text-4xl md:text-5xl font-black text-white mb-4">
          Bankroll Calculator
        </h1>
        <p class="text-gray-400 text-lg max-w-2xl mx-auto">
          Professional session planning with real-time visualization. See exactly how to split your bankroll for maximum longevity.
        </p>
      </div>

      <!-- Main Calculator Grid -->
      <div class="grid lg:grid-cols-2 gap-8 max-w-6xl mx-auto">

        <!-- LEFT: Controls -->
        <div class="space-y-6">

          <!-- Glassmorphism Card -->
          <div class="bg-gradient-to-br from-white/5 to-white/[0.02] backdrop-blur-xl border border-white/10 rounded-2xl p-8 shadow-2xl">

            <!-- Total Bankroll -->
            <div class="mb-8">
              <label class="block text-gold text-sm font-bold mb-4 uppercase tracking-wider">
                Total Bankroll
              </label>

              <!-- Slider -->
              <div class="mb-6">
                <input
                  type="range"
                  id="bankroll-slider"
                  min="100"
                  max="1000000"
                  value="10000"
                  step="100"
                  class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider-gold"
                />
              </div>

              <!-- Display Value -->
              <div class="relative">
                <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-500">$</span>
                <input
                  type="text"
                  id="bankroll-input"
                  value="10,000"
                  class="w-full bg-black/40 border border-gold/30 rounded-xl py-4 pl-8 pr-4 text-white text-2xl font-bold focus:outline-none focus:border-gold transition-all"
                />
              </div>

              <!-- Quick Amounts -->
              <div class="grid grid-cols-4 gap-2 mt-4">
                <button class="quick-amount" data-value="1000">$1K</button>
                <button class="quick-amount" data-value="5000">$5K</button>
                <button class="quick-amount" data-value="10000">$10K</button>
                <button class="quick-amount" data-value="25000">$25K</button>
                <button class="quick-amount" data-value="50000">$50K</button>
                <button class="quick-amount" data-value="100000">$100K</button>
                <button class="quick-amount" data-value="250000">$250K</button>
                <button class="quick-amount" data-value="500000">$500K</button>
              </div>
            </div>

            <!-- Risk Level -->
            <div class="mb-8">
              <label class="block text-gold text-sm font-bold mb-4 uppercase tracking-wider">
                Risk Level
              </label>
              <div class="grid grid-cols-3 gap-3">
                <button class="risk-btn" data-risk="conservative">
                  <span class="block text-2xl mb-2">üõ°Ô∏è</span>
                  <span class="block text-sm font-semibold">Conservative</span>
                  <span class="block text-xs text-gray-500 mt-1">20% per session</span>
                </button>
                <button class="risk-btn active" data-risk="moderate">
                  <span class="block text-2xl mb-2">‚öñÔ∏è</span>
                  <span class="block text-sm font-semibold">Moderate</span>
                  <span class="block text-xs text-gray-500 mt-1">30% per session</span>
                </button>
                <button class="risk-btn" data-risk="aggressive">
                  <span class="block text-2xl mb-2">üî•</span>
                  <span class="block text-sm font-semibold">Aggressive</span>
                  <span class="block text-xs text-gray-500 mt-1">40% per session</span>
                </button>
              </div>
            </div>

            <!-- Session Goal -->
            <div>
              <label class="block text-gold text-sm font-bold mb-4 uppercase tracking-wider">
                Win Goal Multiplier
              </label>
              <div class="flex items-center gap-4">
                <input
                  type="range"
                  id="goal-slider"
                  min="1.5"
                  max="3"
                  value="2"
                  step="0.1"
                  class="flex-1 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer slider-gold"
                />
                <span id="goal-display" class="text-white text-xl font-bold w-16">2.0x</span>
              </div>
              <p class="text-gray-500 text-xs mt-2">Stop when you've made this multiple of your session bankroll</p>
            </div>
          </div>

          <!-- Info Card -->
          <div class="bg-gold/10 border border-gold/30 rounded-xl p-6">
            <h3 class="text-gold font-bold mb-2 flex items-center gap-2">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              Built for Baccarat
            </h3>
            <p class="text-gray-300 text-sm">
              Based on baccarat's 1.06% house edge (Banker). Proper session sizing gives you more hands to catch winning runs while protecting your total bankroll.
            </p>
          </div>
        </div>

        <!-- RIGHT: Visualization & Results -->
        <div class="space-y-6">

          <!-- Chart Card -->
          <div class="bg-gradient-to-br from-white/5 to-white/[0.02] backdrop-blur-xl border border-white/10 rounded-2xl p-8 shadow-2xl">
            <h3 class="text-white text-xl font-bold mb-6 text-center">Bankroll Allocation</h3>
            <div class="relative">
              <canvas id="bankroll-chart" class="max-w-sm mx-auto"></canvas>
            </div>
          </div>

          <!-- Results Grid -->
          <div class="grid grid-cols-2 gap-4">
            <!-- Session Bankroll -->
            <div class="bg-gradient-to-br from-green-500/10 to-green-900/10 border border-green-500/30 rounded-xl p-6 hover:border-green-500/60 transition-all">
              <p class="text-green-400 text-xs font-bold uppercase tracking-wider mb-2">Session Bankroll</p>
              <p id="session-amount" class="text-white text-3xl font-black">$3,000</p>
              <p class="text-gray-400 text-xs mt-1">Per session</p>
            </div>

            <!-- Stop Loss -->
            <div class="bg-gradient-to-br from-red-500/10 to-red-900/10 border border-red-500/30 rounded-xl p-6 hover:border-red-500/60 transition-all">
              <p class="text-red-400 text-xs font-bold uppercase tracking-wider mb-2">Stop Loss</p>
              <p id="stop-loss" class="text-white text-3xl font-black">$1,500</p>
              <p class="text-gray-400 text-xs mt-1">Walk away point</p>
            </div>

            <!-- Win Goal -->
            <div class="bg-gradient-to-br from-gold/10 to-yellow-900/10 border border-gold/30 rounded-xl p-6 hover:border-gold/60 transition-all">
              <p class="text-gold text-xs font-bold uppercase tracking-wider mb-2">Win Goal</p>
              <p id="win-goal" class="text-white text-3xl font-black">$6,000</p>
              <p class="text-gray-400 text-xs mt-1">Take profit point</p>
            </div>

            <!-- Sessions -->
            <div class="bg-gradient-to-br from-blue-500/10 to-blue-900/10 border border-blue-500/30 rounded-xl p-6 hover:border-blue-500/60 transition-all">
              <p class="text-blue-400 text-xs font-bold uppercase tracking-wider mb-2">Total Sessions</p>
              <p id="sessions" class="text-white text-3xl font-black">3.3</p>
              <p class="text-gray-400 text-xs mt-1">Sessions available</p>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="flex gap-3">
            <button
              id="share-btn"
              class="flex-1 bg-gradient-to-r from-gold/20 to-gold/10 border border-gold/50 rounded-xl py-4 px-6 text-gold font-bold hover:from-gold/30 hover:to-gold/20 transition-all flex items-center justify-center gap-2"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
              </svg>
              Share Results
            </button>
            <button
              id="reset-btn"
              class="bg-gray-800 border border-gray-700 rounded-xl py-4 px-6 text-white font-bold hover:bg-gray-700 transition-all"
            >
              Reset
            </button>
          </div>
        </div>
      </div>

      <!-- Strategy Tips -->
      <div class="mt-12 max-w-4xl mx-auto">
        <h2 class="text-white text-2xl font-bold mb-6">Professional Tips</h2>
        <div class="grid md:grid-cols-3 gap-6">
          <div class="bg-white/5 border border-white/10 rounded-xl p-6">
            <h3 class="text-gold font-bold mb-2">Never Chase Losses</h3>
            <p class="text-gray-400 text-sm">Hit your stop loss? Walk away. Come back tomorrow with a fresh session bankroll.</p>
          </div>
          <div class="bg-white/5 border border-white/10 rounded-xl p-6">
            <h3 class="text-gold font-bold mb-2">Lock in Wins</h3>
            <p class="text-gray-400 text-sm">Reached your win goal? Take the profit. The table will always be there tomorrow.</p>
          </div>
          <div class="bg-white/5 border border-white/10 rounded-xl p-6">
            <h3 class="text-gold font-bold mb-2">Track Everything</h3>
            <p class="text-gray-400 text-sm">Keep detailed records of every session. Winners know their numbers.</p>
          </div>
        </div>
      </div>

    </div>
  </main>

  <Footer />
</BaseLayout>

<style>
  /* Custom Slider Styling */
  .slider-gold::-webkit-slider-thumb {
    appearance: none;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: linear-gradient(135deg, #d4a017 0%, #f4d03f 100%);
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(212, 160, 23, 0.4);
    transition: all 0.2s;
  }

  .slider-gold::-webkit-slider-thumb:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(212, 160, 23, 0.6);
  }

  .slider-gold::-moz-range-thumb {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: linear-gradient(135deg, #d4a017 0%, #f4d03f 100%);
    cursor: pointer;
    border: none;
    box-shadow: 0 2px 8px rgba(212, 160, 23, 0.4);
    transition: all 0.2s;
  }

  .slider-gold::-moz-range-thumb:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(212, 160, 23, 0.6);
  }

  /* Quick Amount Buttons */
  .quick-amount {
    background-color: rgb(31 41 55);
    border: 1px solid rgb(55 65 81);
    border-radius: 0.5rem;
    padding: 0.5rem 0.75rem;
    color: white;
    font-size: 0.875rem;
    font-weight: 600;
    transition: all 0.2s;
  }

  .quick-amount:hover {
    background-color: rgb(55 65 81);
    border-color: rgba(212, 160, 23, 0.5);
  }

  /* Risk Buttons */
  .risk-btn {
    background-color: rgb(17 24 39);
    border: 2px solid rgb(55 65 81);
    border-radius: 0.75rem;
    padding: 1rem;
    color: white;
    transition: all 0.2s;
    cursor: pointer;
  }

  .risk-btn:hover {
    border-color: rgba(212, 160, 23, 0.5);
  }

  .risk-btn.active {
    border-color: rgb(212, 160, 23);
    background-color: rgba(212, 160, 23, 0.1);
  }

  /* Animations */
  @keyframes slideUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .space-y-6 > * {
    animation: slideUp 0.4s ease-out both;
  }

  .space-y-6 > *:nth-child(1) { animation-delay: 0.1s; }
  .space-y-6 > *:nth-child(2) { animation-delay: 0.2s; }
  .space-y-6 > *:nth-child(3) { animation-delay: 0.3s; }
</style>

<script>
  import Chart from 'chart.js/auto';

  // Calculator State
  let state = {
    totalBankroll: 10000,
    riskLevel: 'moderate',
    goalMultiplier: 2.0
  };

  const riskLevels = {
    conservative: 0.20,
    moderate: 0.30,
    aggressive: 0.40
  };

  // Chart Instance
  let bankrollChart: Chart | null = null;

  // Format currency
  function formatCurrency(value: number): string {
    return new Intl.NumberFormat('en-US', {
      style: 'currency',
      currency: 'USD',
      minimumFractionDigits: 0,
      maximumFractionDigits: 0
    }).format(value);
  }

  // Format number with commas
  function formatNumber(value: number): string {
    return new Intl.NumberFormat('en-US').format(value);
  }

  // Calculate Results
  function calculate() {
    const sessionPercent = riskLevels[state.riskLevel as keyof typeof riskLevels];
    const sessionBankroll = state.totalBankroll * sessionPercent;
    const stopLoss = sessionBankroll * 0.5; // Stop at 50% loss
    const winGoal = sessionBankroll * state.goalMultiplier;
    const sessions = state.totalBankroll / sessionBankroll;

    return {
      sessionBankroll,
      stopLoss,
      winGoal,
      sessions,
      reserved: state.totalBankroll - sessionBankroll
    };
  }

  // Update Display
  function updateDisplay() {
    const results = calculate();

    // Update text values
    document.getElementById('session-amount')!.textContent = formatCurrency(results.sessionBankroll);
    document.getElementById('stop-loss')!.textContent = formatCurrency(results.stopLoss);
    document.getElementById('win-goal')!.textContent = formatCurrency(results.winGoal);
    document.getElementById('sessions')!.textContent = results.sessions.toFixed(1);
    document.getElementById('bankroll-input')!.setAttribute('value', formatNumber(state.totalBankroll));

    // Update Chart
    updateChart(results);
  }

  // Initialize Chart
  function initChart() {
    const ctx = document.getElementById('bankroll-chart') as HTMLCanvasElement;
    const results = calculate();

    bankrollChart = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Current Session', 'Reserved Bankroll'],
        datasets: [{
          data: [results.sessionBankroll, results.reserved],
          backgroundColor: [
            'rgba(212, 160, 23, 0.8)',
            'rgba(75, 85, 99, 0.4)'
          ],
          borderColor: [
            'rgba(212, 160, 23, 1)',
            'rgba(75, 85, 99, 0.6)'
          ],
          borderWidth: 2
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: true,
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              color: '#fff',
              font: {
                size: 14,
                weight: 'bold'
              },
              padding: 20
            }
          },
          tooltip: {
            callbacks: {
              label: function(context) {
                const label = context.label || '';
                const value = context.parsed;
                const total = context.dataset.data.reduce((a: number, b: number) => a + b, 0);
                const percentage = ((value / total) * 100).toFixed(1);
                return `${label}: ${formatCurrency(value)} (${percentage}%)`;
              }
            }
          }
        },
        animation: {
          animateRotate: true,
          animateScale: true
        }
      }
    });
  }

  // Update Chart
  function updateChart(results: any) {
    if (bankrollChart) {
      bankrollChart.data.datasets[0].data = [results.sessionBankroll, results.reserved];
      bankrollChart.update('active');
    }
  }

  // Event Listeners
  document.addEventListener('DOMContentLoaded', () => {
    // Initialize
    initChart();
    updateDisplay();

    // Bankroll Slider
    const bankrollSlider = document.getElementById('bankroll-slider') as HTMLInputElement;
    const bankrollInput = document.getElementById('bankroll-input') as HTMLInputElement;

    bankrollSlider.addEventListener('input', (e) => {
      state.totalBankroll = parseInt((e.target as HTMLInputElement).value);
      updateDisplay();
    });

    bankrollInput.addEventListener('input', (e) => {
      const value = (e.target as HTMLInputElement).value.replace(/,/g, '');
      const num = parseInt(value) || 0;
      state.totalBankroll = num;
      bankrollSlider.value = num.toString();
      updateDisplay();
    });

    // Quick Amount Buttons
    document.querySelectorAll('.quick-amount').forEach(btn => {
      btn.addEventListener('click', () => {
        const value = parseInt(btn.getAttribute('data-value') || '0');
        state.totalBankroll = value;
        bankrollSlider.value = value.toString();
        updateDisplay();
      });
    });

    // Risk Buttons
    document.querySelectorAll('.risk-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.risk-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        state.riskLevel = btn.getAttribute('data-risk') || 'moderate';
        updateDisplay();
      });
    });

    // Goal Slider
    const goalSlider = document.getElementById('goal-slider') as HTMLInputElement;
    const goalDisplay = document.getElementById('goal-display')!;

    goalSlider.addEventListener('input', (e) => {
      state.goalMultiplier = parseFloat((e.target as HTMLInputElement).value);
      goalDisplay.textContent = state.goalMultiplier.toFixed(1) + 'x';
      updateDisplay();
    });

    // Share Button
    document.getElementById('share-btn')?.addEventListener('click', () => {
      const url = new URL(window.location.href);
      url.searchParams.set('bankroll', state.totalBankroll.toString());
      url.searchParams.set('risk', state.riskLevel);
      url.searchParams.set('goal', state.goalMultiplier.toString());

      navigator.clipboard.writeText(url.toString()).then(() => {
        const btn = document.getElementById('share-btn')!;
        const originalText = btn.innerHTML;
        btn.innerHTML = '‚úì Link Copied!';
        setTimeout(() => {
          btn.innerHTML = originalText;
        }, 2000);
      });
    });

    // Reset Button
    document.getElementById('reset-btn')?.addEventListener('click', () => {
      state = {
        totalBankroll: 10000,
        riskLevel: 'moderate',
        goalMultiplier: 2.0
      };
      bankrollSlider.value = '10000';
      goalSlider.value = '2.0';
      document.querySelectorAll('.risk-btn').forEach(b => b.classList.remove('active'));
      document.querySelector('[data-risk="moderate"]')?.classList.add('active');
      updateDisplay();
    });

    // Load from URL params
    const params = new URLSearchParams(window.location.search);
    if (params.has('bankroll')) {
      state.totalBankroll = parseInt(params.get('bankroll') || '10000');
      bankrollSlider.value = state.totalBankroll.toString();
    }
    if (params.has('risk')) {
      state.riskLevel = params.get('risk') || 'moderate';
      document.querySelectorAll('.risk-btn').forEach(b => b.classList.remove('active'));
      document.querySelector(`[data-risk="${state.riskLevel}"]`)?.classList.add('active');
    }
    if (params.has('goal')) {
      state.goalMultiplier = parseFloat(params.get('goal') || '2.0');
      goalSlider.value = state.goalMultiplier.toString();
      goalDisplay.textContent = state.goalMultiplier.toFixed(1) + 'x';
    }

    updateDisplay();
  });
</script>

---
// Header component - clean, functional, no excess
// Get current path for active state
const currentPath = Astro.url.pathname;

// Helper to check if link is active
const isActive = (href: string) => {
  if (href === '/') return currentPath === '/';
  return currentPath.startsWith(href);
};

// Nav link class helper
const navLinkClass = (href: string) => {
  const base = "transition-colors";
  return isActive(href)
    ? `${base} text-gold font-semibold`
    : `${base} text-white hover:text-gold`;
};

// Aria current helper for accessibility
const ariaCurrent = (href: string) => isActive(href) ? "page" : undefined;
---

<header class="fixed top-0 left-0 right-0 z-50 bg-black border-b border-gray-800" role="banner">
  <nav class="max-w-7xl mx-auto px-4 md:px-8 py-4 flex items-center justify-between" aria-label="Main navigation">
    <!-- Logo - Brand Treatment -->
    <a href="/" class="text-xl md:text-2xl font-black uppercase text-white hover:text-gold transition-colors tracking-widest" aria-label="Mikki Mase - Home">
      Mikki Mase
    </a>

    <!-- Desktop Navigation -->
    <div class="hidden md:flex items-center gap-6">
      <!-- Learn More Mega Menu -->
      <div class="mega-menu-wrapper" id="learn-more-menu">
        <button
          class="mega-menu-trigger transition-colors text-white hover:text-gold flex items-center gap-1"
          aria-expanded="false"
          aria-controls="learn-more-dropdown"
        >
          Learn More
          <svg class="w-4 h-4 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
          </svg>
        </button>

        <div
          id="learn-more-dropdown"
          class="mega-menu-dropdown"
          aria-hidden="true"
        >
          <div class="mega-menu-content">
            <!-- Left Column: Who is Mikki Mase? -->
            <div class="mega-menu-column">
              <h3 class="mega-menu-heading">Who is Mikki Mase?</h3>
              <a href="/story" class="mega-menu-link">
                <span class="mega-menu-link-title">The Complete Story</span>
                <span class="mega-menu-link-desc">From prison to $32M</span>
              </a>
              <a href="/timeline" class="mega-menu-link">
                <span class="mega-menu-link-title">Interactive Timeline</span>
                <span class="mega-menu-link-desc">34 life events mapped</span>
              </a>
              <a href="/faq" class="mega-menu-link">
                <span class="mega-menu-link-title">FAQ (40+ Questions)</span>
                <span class="mega-menu-link-desc">Is he legit? Real name?</span>
              </a>
              <a href="/the-system" class="mega-menu-link">
                <span class="mega-menu-link-title">The System</span>
                <span class="mega-menu-link-desc">How he beats baccarat</span>
              </a>
            </div>

            <!-- Right Column: Results & Proof -->
            <div class="mega-menu-column">
              <h3 class="mega-menu-heading">Results & Proof</h3>
              <a href="/wins" class="mega-menu-link">
                <span class="mega-menu-link-title">Verified Wins</span>
                <span class="mega-menu-link-desc">$10M+ documented</span>
              </a>
              <a href="/net-worth" class="mega-menu-link">
                <span class="mega-menu-link-title">Net Worth</span>
                <span class="mega-menu-link-desc">$20M-$40M assets</span>
              </a>
              <a href="/banned" class="mega-menu-link">
                <span class="mega-menu-link-title">Casino Bans</span>
                <span class="mega-menu-link-desc">150+ properties</span>
              </a>
              <a href="/media" class="mega-menu-link">
                <span class="mega-menu-link-title">Media Appearances</span>
                <span class="mega-menu-link-desc">VladTV, SWU, HCL</span>
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Tools Link -->
      <a href="/tools" class={navLinkClass('/tools')} aria-current={ariaCurrent('/tools')}>Tools</a>

      <!-- Bedroom Boss Link (Shop) -->
      <a href="/bedroom-boss" class="flex items-center gap-1.5 text-gold hover:text-gold-light transition-colors font-medium">
        Bedroom Boss
        <span class="text-[10px] bg-[#A8001E] text-white px-1.5 py-0.5 rounded font-bold uppercase">New</span>
      </a>

      <!-- Join Community CTA -->
      <a href="/join" class="btn btn-primary">
        Join Community
      </a>
    </div>

    <!-- Mobile Menu Button -->
    <button
      id="mobile-menu-toggle"
      class="md:hidden text-white p-2 min-w-[44px] min-h-[44px] flex items-center justify-center rounded-lg hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-gold focus:ring-offset-2 focus:ring-offset-black transition-colors"
      aria-label="Toggle menu"
      aria-expanded="false"
      aria-controls="mobile-menu"
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>
  </nav>

  <!-- Mobile Menu -->
  <div
    id="mobile-menu"
    class="hidden md:hidden bg-gray-900 border-t border-gray-800"
  >
    <div class="px-4 py-4 flex flex-col gap-4">
      <!-- Bedroom Boss - Featured at top -->
      <a href="/bedroom-boss" class="flex items-center justify-between py-3 px-4 bg-gradient-to-r from-gold/10 to-transparent border border-gold/30 rounded-lg">
        <span class="text-gold font-semibold">Bedroom Boss</span>
        <span class="text-[10px] bg-[#A8001E] text-white px-1.5 py-0.5 rounded font-bold uppercase">New</span>
      </a>

      <a href="/story" class={`${navLinkClass('/story')} py-2`}>Story</a>
      <a href="/wins" class={`${navLinkClass('/wins')} py-2`}>Wins</a>
      <a href="/the-system" class={`${navLinkClass('/the-system')} py-2`}>Strategy</a>
      <a href="/banned" class={`${navLinkClass('/banned')} py-2`}>Banned</a>
      <a href="/net-worth" class={`${navLinkClass('/net-worth')} py-2`}>Net Worth</a>
      <a href="/tools" class={`${navLinkClass('/tools')} py-2`}>Tools</a>
      <a href="/faq" class={`${navLinkClass('/faq')} py-2`}>FAQ</a>
      <a href="/join" class="btn btn-primary w-full text-center">
        Join Community
      </a>
    </div>
  </div>
</header>

<!-- Header spacer (so content doesn't hide under fixed header) -->
<div class="h-20"></div>

<style>
  /* Mega Menu Styles */
  .mega-menu-wrapper {
    position: relative;
  }

  .mega-menu-trigger {
    font-size: 16px;
    font-weight: 400;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
  }

  .mega-menu-trigger:hover svg,
  .mega-menu-trigger[aria-expanded="true"] svg {
    transform: rotate(180deg);
  }

  .mega-menu-dropdown {
    position: absolute;
    top: calc(100% + 24px);
    left: 50%;
    transform: translateX(-50%);
    min-width: 560px;
    background: #1a1a1a;
    border: 1px solid rgba(212, 160, 23, 0.3);
    border-radius: 12px;
    padding: 24px;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease;
    transform: translateX(-50%) translateY(-8px);
    z-index: 100;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
  }

  .mega-menu-dropdown[aria-hidden="false"] {
    opacity: 1;
    visibility: visible;
    transform: translateX(-50%) translateY(0);
  }

  .mega-menu-content {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 32px;
  }

  .mega-menu-column {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .mega-menu-heading {
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: rgba(255, 255, 255, 0.5);
    margin-bottom: 12px;
  }

  .mega-menu-link {
    display: flex;
    flex-direction: column;
    padding: 12px 16px;
    border-radius: 8px;
    text-decoration: none;
    transition: background 0.15s ease;
  }

  .mega-menu-link:hover {
    background: rgba(212, 160, 23, 0.1);
  }

  .mega-menu-link-title {
    font-size: 15px;
    font-weight: 600;
    color: white;
    margin-bottom: 2px;
  }

  .mega-menu-link-desc {
    font-size: 13px;
    color: rgba(255, 255, 255, 0.5);
  }

  /* Active state for current page */
  .mega-menu-link[data-active="true"] {
    background: rgba(212, 160, 23, 0.15);
  }

  .mega-menu-link[data-active="true"] .mega-menu-link-title {
    color: #d4a017;
  }
</style>

<script>
  // Mobile menu toggle
  const toggle = document.getElementById('mobile-menu-toggle');
  const menu = document.getElementById('mobile-menu');
  const menuIcon = toggle?.querySelector('svg');

  toggle?.addEventListener('click', () => {
    const isOpen = !menu?.classList.contains('hidden');
    menu?.classList.toggle('hidden');
    toggle.setAttribute('aria-expanded', String(!isOpen));
    // Swap icon between hamburger and X
    if (menuIcon) {
      menuIcon.innerHTML = isOpen
        ? '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />'
        : '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />';
    }
  });

  // Close menu when clicking a link
  menu?.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => {
      menu.classList.add('hidden');
      toggle?.setAttribute('aria-expanded', 'false');
      if (menuIcon) {
        menuIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />';
      }
    });
  });

  // Close menu on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !menu?.classList.contains('hidden')) {
      menu?.classList.add('hidden');
      toggle?.setAttribute('aria-expanded', 'false');
      toggle?.focus();
      if (menuIcon) {
        menuIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />';
      }
    }
  });

  // Mega Menu functionality
  const learnMoreTrigger = document.querySelector('#learn-more-menu .mega-menu-trigger');
  const learnMoreDropdown = document.getElementById('learn-more-dropdown');
  const learnMoreWrapper = document.getElementById('learn-more-menu');

  let isHoveringTrigger = false;
  let isHoveringDropdown = false;
  let closeTimeout: ReturnType<typeof setTimeout> | null = null;

  function openMegaMenu() {
    if (closeTimeout) {
      clearTimeout(closeTimeout);
      closeTimeout = null;
    }
    learnMoreDropdown?.setAttribute('aria-hidden', 'false');
    learnMoreTrigger?.setAttribute('aria-expanded', 'true');
  }

  function closeMegaMenu() {
    closeTimeout = setTimeout(() => {
      if (!isHoveringTrigger && !isHoveringDropdown) {
        learnMoreDropdown?.setAttribute('aria-hidden', 'true');
        learnMoreTrigger?.setAttribute('aria-expanded', 'false');
      }
    }, 150); // 150ms delay for smooth UX
  }

  // Trigger hover events
  learnMoreTrigger?.addEventListener('mouseenter', () => {
    isHoveringTrigger = true;
    openMegaMenu();
  });

  learnMoreTrigger?.addEventListener('mouseleave', () => {
    isHoveringTrigger = false;
    closeMegaMenu();
  });

  // Dropdown hover events
  learnMoreDropdown?.addEventListener('mouseenter', () => {
    isHoveringDropdown = true;
    openMegaMenu();
  });

  learnMoreDropdown?.addEventListener('mouseleave', () => {
    isHoveringDropdown = false;
    closeMegaMenu();
  });

  // Click to toggle (for touch devices)
  learnMoreTrigger?.addEventListener('click', (e) => {
    e.preventDefault();
    const isOpen = learnMoreDropdown?.getAttribute('aria-hidden') === 'false';
    if (isOpen) {
      learnMoreDropdown?.setAttribute('aria-hidden', 'true');
      learnMoreTrigger?.setAttribute('aria-expanded', 'false');
    } else {
      openMegaMenu();
    }
  });

  // Close mega menu on Escape
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && learnMoreDropdown?.getAttribute('aria-hidden') === 'false') {
      learnMoreDropdown?.setAttribute('aria-hidden', 'true');
      learnMoreTrigger?.setAttribute('aria-expanded', 'false');
      learnMoreTrigger?.focus();
    }
  });

  // Highlight active page in mega menu
  const currentPath = window.location.pathname;
  const megaMenuLinks = learnMoreDropdown?.querySelectorAll('.mega-menu-link');

  megaMenuLinks?.forEach(link => {
    const href = link.getAttribute('href');
    if (href && currentPath.startsWith(href) && href !== '/') {
      link.setAttribute('data-active', 'true');
    }
  });
</script>
